<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Backend 001</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Courier New', monospace;
      background: #0a0a0a;
      color: #00ff00;
      height: 100vh;
      overflow: hidden;
    }
    
    .terminal {
      width: 100vw;
      height: 100vh;
      background: #000;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .terminal-header {
      background: #1a1a1a;
      padding: 10px 15px;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .terminal-btn {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }
    
    .btn-red { background: #ff5f56; }
    .btn-yellow { background: #ffbd2e; }
    .btn-green { background: #27c93f; }
    
    .terminal-title {
      margin-left: 15px;
      color: #888;
      font-size: 12px;
    }
    
    .terminal-status {
      margin-left: auto;
      font-size: 12px;
      color: #0af;
    }
    
    .terminal-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      font-size: 14px;
      line-height: 1.6;
    }
    
    .login-screen {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .prompt-line {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .prompt-text {
      color: #0af;
      margin-right: 5px;
    }
    
    input {
      background: transparent;
      border: none;
      color: #00ff00;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      outline: none;
      flex: 1;
    }
    
    input[type="password"] {
      color: #00ff00;
    }
    
    .output {
      margin: 10px 0;
      white-space: pre-wrap;
    }
    
    .error {
      color: #ff3333;
    }
    
    .success {
      color: #00ff00;
    }
    
    .info {
      color: #0af;
    }
    
    .warning {
      color: #ffbd2e;
    }
    
    .hidden {
      display: none;
    }
    
    .server-interface {
      display: none;
      flex-direction: column;
      gap: 15px;
      height: 100%;
    }
    
    .command-line {
      display: flex;
      align-items: center;
      margin-top: auto;
      padding-top: 10px;
      border-top: 1px solid #333;
    }
    
    .command-prompt {
      color: #0af;
      margin-right: 5px;
    }
    
    .log-entry {
      margin: 5px 0;
      padding-left: 10px;
      border-left: 2px solid #0af;
    }
    
    .endpoint-info {
      color: #ffbd2e;
      margin: 5px 0;
    }
    
    .code-block {
      background: #1a1a1a;
      border: 1px solid #333;
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }
    
    .stat-box {
      background: #1a1a1a;
      border: 1px solid #0af;
      padding: 15px;
      border-radius: 4px;
    }
    
    .stat-value {
      font-size: 24px;
      color: #00ff00;
      font-weight: bold;
    }
    
    .stat-label {
      font-size: 12px;
      color: #888;
      margin-top: 5px;
    }
    
    ::-webkit-scrollbar {
      width: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: #0a0a0a;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #333;
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <div class="terminal">
    <div class="terminal-header">
      <div class="terminal-btn btn-red"></div>
      <div class="terminal-btn btn-yellow"></div>
      <div class="terminal-btn btn-green"></div>
      <span class="terminal-title">root@global-server ~ v3.0.0 GLOBAL MODE</span>
      <span class="terminal-status" id="serverStatus">● ONLINE</span>
    </div>
    
    <div class="terminal-body" id="terminal">
      <!-- Login Screen -->
      <div id="loginScreen" class="login-screen">
        <div class="output success">
╔══════════════════════════════════════════════════════╗
║     GLOBAL BACKEND SERVER v3.0.0                     ║
║     Cloud-Synchronized Database System               ║
║     Authorization Required                           ║
╚══════════════════════════════════════════════════════╝
        </div>
        <div class="output info">System initialized at [<span id="initTime"></span>]</div>
        <div class="output">Connecting to global network... [OK]</div>
        <div class="output">Establishing encrypted tunnel... [OK]</div>
        <div class="output" style="margin-bottom: 20px;">──────────────────────────────────────────────────────</div>
        
        <div class="prompt-line">
          <span class="prompt-text">Username:</span>
          <input type="text" id="username" autocomplete="off" autofocus>
        </div>
        
        <div class="prompt-line hidden" id="passwordPrompt">
          <span class="prompt-text">Password:</span>
          <input type="password" id="password" autocomplete="off">
        </div>
      </div>
      
      <!-- Server Interface -->
      <div id="serverInterface" class="server-interface">
        <div class="output success">
╔══════════════════════════════════════════════════════╗
║        ACCESS GRANTED - GLOBAL ADMIN MODE            ║
╚══════════════════════════════════════════════════════╝
        </div>
        <div class="output info" id="welcomeMsg"></div>
        <div class="output" style="margin-bottom: 10px;">──────────────────────────────────────────────────────</div>
        
        <div id="statsSection" style="display:none;">
          <div class="output warning">═══ GLOBAL SERVER STATISTICS ═══</div>
          <div class="stats-grid" id="statsGrid"></div>
          <div class="output" style="margin: 15px 0;">──────────────────────────────────────────────────────</div>
        </div>
        
        <div id="logs"></div>
        
        <div class="command-line">
          <span class="command-prompt">root@global:~#</span>
          <input type="text" id="commandInput" autocomplete="off" placeholder="type 'help' for commands">
        </div>
      </div>
    </div>
  </div>

  <script>
    // Initialize
    document.getElementById('initTime').textContent = new Date().toLocaleString();
    
    // Users database
    const users = {
      'admin': 'admin123',
      'root': 'password',
      'user': 'user'
    };
    
    // Global storage key - shared across ALL users
    const GLOBAL_STORAGE_KEY = 'global_backend_server_v3';
    
    let currentUser = null;
    
    // Global database functions with cloud storage
    async function getGlobalData() {
      try {
        const data = await window.storage.get(GLOBAL_STORAGE_KEY, true); // true = shared/global
        return data ? JSON.parse(data.value) : initializeDatabase();
      } catch (error) {
        console.log('Initializing new global database');
        return initializeDatabase();
      }
    }
    
    async function saveGlobalData(data) {
      try {
        await window.storage.set(GLOBAL_STORAGE_KEY, JSON.stringify(data), true); // true = shared/global
        return true;
      } catch (error) {
        console.error('Failed to save to global storage:', error);
        return false;
      }
    }
    
    function initializeDatabase() {
      return {
        users: [],
        scores: [],
        sessions: [],
        data: [],
        analytics: {
          totalPlayers: 0,
          totalGames: 0,
          highestScore: 0,
          lastUpdated: Date.now()
        }
      };
    }
    
    // Login handling
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const passwordPrompt = document.getElementById('passwordPrompt');
    const loginScreen = document.getElementById('loginScreen');
    const serverInterface = document.getElementById('serverInterface');
    
    usernameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const username = usernameInput.value.trim();
        if (username) {
          usernameInput.disabled = true;
          passwordPrompt.classList.remove('hidden');
          passwordInput.focus();
        }
      }
    });
    
    passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const username = usernameInput.value.trim();
        const password = passwordInput.value;
        
        if (users[username] && users[username] === password) {
          currentUser = username;
          loginSuccess();
        } else {
          loginFailed();
        }
      }
    });
    
    async function loginSuccess() {
      loginScreen.style.display = 'none';
      serverInterface.style.display = 'flex';
      document.getElementById('welcomeMsg').textContent = `Logged in as: ${currentUser}@global-server [${new Date().toLocaleTimeString()}]`;
      document.getElementById('commandInput').focus();
      
      // Log session
      const db = await getGlobalData();
      db.sessions.push({
        user: currentUser,
        timestamp: Date.now(),
        ip: 'local'
      });
      await saveGlobalData(db);
      
      log('Connected to global database. Type "help" for commands.');
      log('All data is synchronized across all users globally.', 'warning');
    }
    
    function loginFailed() {
      const errorMsg = document.createElement('div');
      errorMsg.className = 'output error';
      errorMsg.textContent = '\n[ERROR] Authentication failed. Access denied.';
      loginScreen.appendChild(errorMsg);
      
      setTimeout(() => {
        passwordInput.value = '';
        usernameInput.value = '';
        usernameInput.disabled = false;
        passwordPrompt.classList.add('hidden');
        usernameInput.focus();
        errorMsg.remove();
      }, 2000);
    }
    
    // Command handling
    const commandInput = document.getElementById('commandInput');
    const logsDiv = document.getElementById('logs');
    
    function log(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      const time = new Date().toLocaleTimeString();
      entry.textContent = `[${time}] ${message}`;
      logsDiv.appendChild(entry);
      logsDiv.scrollTop = logsDiv.scrollHeight;
    }
    
    commandInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const cmd = commandInput.value.trim();
        if (cmd) {
          executeCommand(cmd);
          commandInput.value = '';
        }
      }
    });
    
    async function executeCommand(cmd) {
      log(`> ${cmd}`, 'info');
      
      const parts = cmd.split(' ');
      const command = parts[0].toLowerCase();
      
      if (command === 'help') {
        log('═══════════════ AVAILABLE COMMANDS ═══════════════', 'success');
        log('  help              - Show this help message');
        log('  stats             - Show global server statistics');
        log('  scores [limit]    - Show global game scores');
        log('  players           - List all registered players');
        log('  sessions          - Show recent login sessions');
        log('  data              - View all global data (JSON)');
        log('  add <player> <score> - Manually add a score');
        log('  purge             - Clear ALL global data (DANGER)');
        log('  export            - Export database to JSON');
        log('  integrate         - Show game integration code');
        log('  clear             - Clear the screen');
        log('  logout            - Logout from server');
        log('══════════════════════════════════════════════════', 'success');
      } else if (command === 'stats') {
        const db = await getGlobalData();
        log('═══════════ GLOBAL SERVER STATISTICS ═══════════', 'warning');
        log(`Total Players: ${db.analytics.totalPlayers}`);
        log(`Total Games: ${db.analytics.totalGames}`);
        log(`Highest Score: ${db.analytics.highestScore}`);
        log(`Total Scores Recorded: ${db.scores.length}`);
        log(`Active Sessions Today: ${db.sessions.filter(s => Date.now() - s.timestamp < 86400000).length}`);
        log(`Database Size: ${JSON.stringify(db).length} bytes`);
        log(`Last Updated: ${new Date(db.analytics.lastUpdated).toLocaleString()}`);
        log('═══════════════════════════════════════════════', 'warning');
      } else if (command === 'scores') {
        const limit = parseInt(parts[1]) || 10;
        const db = await getGlobalData();
        if (db.scores.length === 0) {
          log('No global scores recorded yet', 'warning');
        } else {
          log(`═══════════ TOP ${limit} GLOBAL SCORES ═══════════`, 'success');
          db.scores.slice(0, limit).forEach((s, i) => {
            const date = new Date(s.timestamp).toLocaleString();
            log(`  ${i + 1}. ${s.player} - ${s.score} pts [${date}]`);
          });
          log(`Total: ${db.scores.length} scores in database`, 'info');
          log('═══════════════════════════════════════════════', 'success');
        }
      } else if (command === 'players') {
        const db = await getGlobalData();
        const playerMap = {};
        db.scores.forEach(s => {
          if (!playerMap[s.player]) {
            playerMap[s.player] = { games: 0, totalScore: 0, highScore: 0 };
          }
          playerMap[s.player].games++;
          playerMap[s.player].totalScore += s.score;
          playerMap[s.player].highScore = Math.max(playerMap[s.player].highScore, s.score);
        });
        
        log('═══════════ REGISTERED PLAYERS ═══════════', 'success');
        Object.entries(playerMap).forEach(([name, stats]) => {
          log(`\n  Player: ${name}`);
          log(`    Games Played: ${stats.games}`);
          log(`    High Score: ${stats.highScore}`);
          log(`    Average Score: ${Math.round(stats.totalScore / stats.games)}`);
        });
        log('\n═══════════════════════════════════════════', 'success');
      } else if (command === 'sessions') {
        const db = await getGlobalData();
        log('═══════════ RECENT SESSIONS ═══════════', 'info');
        db.sessions.slice(-20).reverse().forEach(s => {
          log(`  ${s.user} - ${new Date(s.timestamp).toLocaleString()}`);
        });
        log('═══════════════════════════════════════', 'info');
      } else if (command === 'data') {
        const db = await getGlobalData();
        log('Raw global database:', 'info');
        const codeBlock = document.createElement('div');
        codeBlock.className = 'code-block';
        codeBlock.textContent = JSON.stringify(db, null, 2);
        logsDiv.appendChild(codeBlock);
      } else if (command === 'add') {
        const playerName = parts[1];
        const score = parseInt(parts[2]);
        if (!playerName || isNaN(score)) {
          log('Usage: add <player> <score>', 'error');
        } else {
          const db = await getGlobalData();
          const newScore = {
            id: Date.now(),
            player: playerName,
            score: score,
            timestamp: Date.now()
          };
          db.scores.push(newScore);
          db.scores.sort((a, b) => b.score - a.score);
          db.analytics.totalGames++;
          db.analytics.highestScore = Math.max(db.analytics.highestScore, score);
          db.analytics.lastUpdated = Date.now();
          await saveGlobalData(db);
          log(`Score added: ${playerName} - ${score} pts`, 'success');
        }
      } else if (command === 'purge') {
        log('WARNING: This will delete ALL global data!', 'error');
        log('Type "purge confirm" to proceed', 'warning');
        if (parts[1] === 'confirm') {
          const newDb = initializeDatabase();
          await saveGlobalData(newDb);
          log('All global data has been purged!', 'success');
        }
      } else if (command === 'export') {
        const db = await getGlobalData();
        const dataStr = JSON.stringify(db, null, 2);
        log('Database exported. Copy the data below:', 'success');
        const codeBlock = document.createElement('div');
        codeBlock.className = 'code-block';
        codeBlock.textContent = dataStr;
        logsDiv.appendChild(codeBlock);
      } else if (command === 'integrate') {
        log('═══════════ GLOBAL INTEGRATION CODE ═══════════', 'warning');
        log('\nCopy this code into your game HTML file:\n', 'success');
        
        const integrationCode = `<script>
// Global Backend Server Integration
const GLOBAL_STORAGE_KEY = 'global_backend_server_v3';

// Get global data (shared across ALL users)
async function getGlobalData() {
  try {
    const data = await window.storage.get(GLOBAL_STORAGE_KEY, true);
    return data ? JSON.parse(data.value) : {
      scores: [],
      analytics: { totalPlayers: 0, totalGames: 0, highestScore: 0 }
    };
  } catch (error) {
    return { scores: [], analytics: { totalPlayers: 0, totalGames: 0, highestScore: 0 } };
  }
}

// Save global data
async function saveGlobalData(data) {
  try {
    await window.storage.set(GLOBAL_STORAGE_KEY, JSON.stringify(data), true);
    return true;
  } catch (error) {
    console.error('Failed to save:', error);
    return false;
  }
}

// Submit score to global leaderboard
async function submitScore(playerName, score) {
  const db = await getGlobalData();
  const newScore = {
    id: Date.now(),
    player: playerName,
    score: score,
    timestamp: Date.now()
  };
  
  db.scores.push(newScore);
  db.scores.sort((a, b) => b.score - a.score);
  db.analytics.totalGames++;
  db.analytics.highestScore = Math.max(db.analytics.highestScore || 0, score);
  db.analytics.lastUpdated = Date.now();
  
  await saveGlobalData(db);
  console.log('Score submitted to global leaderboard:', newScore);
  return { success: true, score: newScore, rank: db.scores.indexOf(newScore) + 1 };
}

// Get global leaderboard
async function getLeaderboard() {
  const db = await getGlobalData();
  return { 
    scores: db.scores.slice(0, 10),
    total: db.scores.length 
  };
}

// Example usage:
// await submitScore('Player1', 1000);
// const leaderboard = await getLeaderboard();
<\/script>`;
        
        const codeBlock = document.createElement('div');
        codeBlock.className = 'code-block';
        codeBlock.textContent = integrationCode;
        logsDiv.appendChild(codeBlock);
        
        log('\n═══════════════════════════════════════════════', 'warning');
        log('This code uses GLOBAL storage - all players share the same leaderboard!', 'info');
      } else if (command === 'clear') {
        logsDiv.innerHTML = '';
      } else if (command === 'logout') {
        location.reload();
      } else {
        log(`Unknown command: ${command}. Type 'help' for available commands.`, 'error');
      }
    }
  </script>
</body>
</html>
